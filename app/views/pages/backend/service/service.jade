extends ../admin_layout

block content
  .container
    .row
      aside.col-md-3
        ul.list-group
          li.list-group-item bruno
      .col-md-9
        ul#message(style="height: 500px; overflow: scroll")
        form#chat.form-group(action="")
          .col-md-10
            input.form-control#m(type="text", autocomplete="off", data-id)
          .col-md-2
            button.form-control.btn.btn-success 发送

block script
  script(src="/libs/socket.io/socket.io-1.3.5.js")
  script(src="/libs/jquery.cookie/jquery.cookie.js")
  script.
    var socket = io();
    var $chat = $('#chat');
    var $input = $('#m');
    var uid = $.cookie('uid');

    socket.emit('admin_welcome', uid);

    socket.on('admin_welcome', function(msg){
      $('#message').append($('<li>').text(msg).addClass('me'));
    });
    
    socket.on('admin_message', function(json){
      $input.data('id', json.id);
      $('#message').append($('<li>').text(json.msg).addClass('user'));
    })

    $chat.on('submit', function(e){
      e.preventDefault();
      
      socket.emit('admin_say', {
        msg: $input.val(),
        id: $input.data('id')
      });
    })






