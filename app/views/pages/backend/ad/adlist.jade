extends ../admin_layout

block content
  .container
    .row
      a.btn.btn-success.col-md-1.col-md-offset-11(href="/admin/ad/new") 增加新闻
      table.table.table-hover.table-striped
        thead
          tr
            th 广告标题
            th 广告图预览
            th 最后更新时间
            th 查看
            th 编辑
            th 删除
        tbody
          each ad in ads
            tr(class="ad-id-#{ad._id}")
              td #{ad.title}
              td: img(src="#{ad.imgSrc}", alt="#{ad.title}", style="max-width: 200px;")
              td #{moment(ad.meta.updateAt).format('YYYY/MM/DD hh:mm:ss')}
              td: a(href="/ad/detail/#{ad._id}", target="_blank") 查看
              td: a(href="/admin/ad/update/#{ad._id}", target="_blank") 编辑
              td: button.btn.btn-danger.ad-del(data-id="#{ad._id}") 删除
block script
  script(src="/p/js/func.js")
  script#content-list(type="text/x-handlebars-template").
    {{#each list}}
      <tr class="ad-id-{{id}}">
        <td>
          {{title}}
        </td>
        <td>
          <img(src="{{imgSrc}}", alt="{{title}}", style="max-width: 200px;")>
        </td>
        <td>{{time}}</td>
        <td>
          <a href="/ad/detail/{{id}}">查看</a>
        </td>
        <td>
          <a href="/admin/ad/update/{{id}}">编辑</a>
        </td>
        <td>
          <button class="btn btn-danger ad-del" data-id="{{id}}">
            删除
          </button>
        </td>
      </tr>
    {{/each}}  
  script(type="text/javascript").
    var $pagination = $('.pagination');
    var $page = $pagination.find('a');
    if($pagination.find('li').length === 2) {
      $pagination.hide();
    }
    $page.on('click', function(e){
      e.preventDefault();
      var $t = $(this);
      var $tbody = $('table tbody');
      var href = $t.attr('href');
      
      $.get(href, function(data){
        if(data.success) {
          $tbody.empty();

          var obj = data.data.object;
          var tpl = $('#content-list').html();
          var template = Handlebars.compile(tpl); 
          var content = {
            list: []
          };

          $.each(obj, function(index, item) {
            var obj = {
              id: item._id,
              title: item.title,
              imgSrc: item.imgSrc,
              time: moment(item.meta.updateAt).format('YYYY/MM/DD hh:mm:ss')
            };
            content.list.push(obj);
          });
          
          var html = template(content);
          
          $tbody.html(html);
        } else {
          //OE.alert(data.data.msg);
        }
      })
    });